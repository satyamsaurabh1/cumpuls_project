{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import io from'socket.io-client';import{useAuth}from'./AuthContext';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SocketContext=/*#__PURE__*/createContext();export const useSocket=()=>{const context=useContext(SocketContext);if(!context){throw new Error('useSocket must be used within a SocketProvider');}return context;};export const SocketProvider=_ref=>{let{children}=_ref;const[socket,setSocket]=useState(null);const[onlineUsers,setOnlineUsers]=useState([]);const{user,isAuthenticated}=useAuth();useEffect(()=>{if(isAuthenticated&&user){const SOCKET_URL=process.env.REACT_APP_SOCKET_URL||'http://localhost:5001';const newSocket=io(SOCKET_URL,{auth:{token:localStorage.getItem('token')}});newSocket.on('connect',()=>{console.log('Socket connected');});newSocket.on('user:online',users=>{setOnlineUsers(users);});newSocket.on('user:offline',userId=>{setOnlineUsers(prev=>prev.filter(id=>id!==userId));});newSocket.on('message:received',message=>{toast.custom(t=>/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(t.visible?'animate-enter':'animate-leave',\" max-w-md w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 w-0 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 pt-0.5\",children:/*#__PURE__*/_jsx(\"img\",{className:\"h-10 w-10 rounded-full\",src:message.sender.avatar,alt:\"\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3 flex-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900\",children:message.sender.name}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:message.content})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex border-l border-gray-200\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>{window.location.href=\"/messages/\".concat(message.sender._id);toast.dismiss(t.id);},className:\"w-full border border-transparent rounded-none rounded-r-lg p-4 flex items-center justify-center text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none\",children:\"Reply\"})})]}),{duration:5000});});newSocket.on('error',error=>{toast.error(error.message);});setSocket(newSocket);return()=>{newSocket.close();};}},[isAuthenticated,user]);const joinConversation=userId=>{if(socket){socket.emit('conversation:join',{userId});}};const sendMessage=(receiverId,content)=>{if(socket){socket.emit('message:send',{receiverId,content});}};const startTyping=receiverId=>{if(socket){socket.emit('typing:start',{receiverId});}};const stopTyping=receiverId=>{if(socket){socket.emit('typing:stop',{receiverId});}};const value={socket,onlineUsers,joinConversation,sendMessage,startTyping,stopTyping,isOnline:userId=>onlineUsers.includes(userId)};return/*#__PURE__*/_jsx(SocketContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","io","useAuth","toast","jsx","_jsx","jsxs","_jsxs","SocketContext","useSocket","context","Error","SocketProvider","_ref","children","socket","setSocket","onlineUsers","setOnlineUsers","user","isAuthenticated","SOCKET_URL","process","env","REACT_APP_SOCKET_URL","newSocket","auth","token","localStorage","getItem","on","console","log","users","userId","prev","filter","id","message","custom","t","className","concat","visible","src","sender","avatar","alt","name","content","onClick","window","location","href","_id","dismiss","duration","error","close","joinConversation","emit","sendMessage","receiverId","startTyping","stopTyping","value","isOnline","includes","Provider"],"sources":["C:/Users/satya/OneDrive/Desktop/creatorconnect-backend/frontend/src/context/SocketContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport io from 'socket.io-client';\r\nimport { useAuth } from './AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst SocketContext = createContext();\r\n\r\nexport const useSocket = () => {\r\n  const context = useContext(SocketContext);\r\n  if (!context) {\r\n    throw new Error('useSocket must be used within a SocketProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const SocketProvider = ({ children }) => {\r\n  const [socket, setSocket] = useState(null);\r\n  const [onlineUsers, setOnlineUsers] = useState([]);\r\n  const { user, isAuthenticated } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:5001';\n      \r\n      const newSocket = io(SOCKET_URL, {\r\n        auth: {\r\n          token: localStorage.getItem('token')\r\n        }\r\n      });\r\n\r\n      newSocket.on('connect', () => {\r\n        console.log('Socket connected');\r\n      });\r\n\r\n      newSocket.on('user:online', (users) => {\r\n        setOnlineUsers(users);\r\n      });\r\n\r\n      newSocket.on('user:offline', (userId) => {\r\n        setOnlineUsers(prev => prev.filter(id => id !== userId));\r\n      });\r\n\r\n      newSocket.on('message:received', (message) => {\r\n        toast.custom((t) => (\r\n          <div className={`${t.visible ? 'animate-enter' : 'animate-leave'} max-w-md w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`}>\r\n            <div className=\"flex-1 w-0 p-4\">\r\n              <div className=\"flex items-start\">\r\n                <div className=\"flex-shrink-0 pt-0.5\">\r\n                  <img\r\n                    className=\"h-10 w-10 rounded-full\"\r\n                    src={message.sender.avatar}\r\n                    alt=\"\"\r\n                  />\r\n                </div>\r\n                <div className=\"ml-3 flex-1\">\r\n                  <p className=\"text-sm font-medium text-gray-900\">\r\n                    {message.sender.name}\r\n                  </p>\r\n                  <p className=\"mt-1 text-sm text-gray-500\">\r\n                    {message.content}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex border-l border-gray-200\">\r\n              <button\r\n                onClick={() => {\r\n                  window.location.href = `/messages/${message.sender._id}`;\r\n                  toast.dismiss(t.id);\r\n                }}\r\n                className=\"w-full border border-transparent rounded-none rounded-r-lg p-4 flex items-center justify-center text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none\"\r\n              >\r\n                Reply\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ), {\r\n          duration: 5000,\r\n        });\r\n      });\r\n\r\n      newSocket.on('error', (error) => {\r\n        toast.error(error.message);\r\n      });\r\n\r\n      setSocket(newSocket);\r\n\r\n      return () => {\r\n        newSocket.close();\r\n      };\r\n    }\r\n  }, [isAuthenticated, user]);\r\n\r\n  const joinConversation = (userId) => {\r\n    if (socket) {\r\n      socket.emit('conversation:join', { userId });\r\n    }\r\n  };\r\n\r\n  const sendMessage = (receiverId, content) => {\r\n    if (socket) {\r\n      socket.emit('message:send', { receiverId, content });\r\n    }\r\n  };\r\n\r\n  const startTyping = (receiverId) => {\r\n    if (socket) {\r\n      socket.emit('typing:start', { receiverId });\r\n    }\r\n  };\r\n\r\n  const stopTyping = (receiverId) => {\r\n    if (socket) {\r\n      socket.emit('typing:stop', { receiverId });\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    socket,\r\n    onlineUsers,\r\n    joinConversation,\r\n    sendMessage,\r\n    startTyping,\r\n    stopTyping,\r\n    isOnline: (userId) => onlineUsers.includes(userId)\r\n  };\r\n\r\n  return (\r\n    <SocketContext.Provider value={value}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}