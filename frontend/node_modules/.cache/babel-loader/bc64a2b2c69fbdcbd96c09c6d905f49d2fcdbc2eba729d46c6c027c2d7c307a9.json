{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\satya\\\\OneDrive\\\\Desktop\\\\creatorconnect-backend\\\\frontend\\\\src\\\\context\\\\SocketContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport { useAuth } from './AuthContext';\nimport toast from 'react-hot-toast';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SocketContext = /*#__PURE__*/createContext();\nexport const useSocket = () => {\n  _s();\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n_s(useSocket, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const SocketProvider = ({\n  children\n}) => {\n  _s2();\n  const [socket, setSocket] = useState(null);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const {\n    user,\n    isAuthenticated\n  } = useAuth();\n  const seenMessageIdsRef = React.useRef(new Set());\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:5001';\n      const newSocket = io(SOCKET_URL, {\n        auth: {\n          token: localStorage.getItem('token')\n        }\n      });\n      newSocket.on('connect', () => {\n        console.log('Socket connected');\n      });\n      newSocket.on('user:online', users => {\n        setOnlineUsers(users);\n      });\n      newSocket.on('user:offline', userId => {\n        setOnlineUsers(prev => prev.filter(id => id !== userId));\n      });\n      newSocket.on('message:received', message => {\n        var _message$sender, _message$sender$_id, _message$sender$_id$t, _message$receiver, _message$receiver$_id, _message$receiver$_id2, _user$_id, _user$_id$toString;\n        const messageId = message === null || message === void 0 ? void 0 : message._id;\n        const senderId = (message === null || message === void 0 ? void 0 : (_message$sender = message.sender) === null || _message$sender === void 0 ? void 0 : (_message$sender$_id = _message$sender._id) === null || _message$sender$_id === void 0 ? void 0 : (_message$sender$_id$t = _message$sender$_id.toString) === null || _message$sender$_id$t === void 0 ? void 0 : _message$sender$_id$t.call(_message$sender$_id)) || '';\n        const receiverId = (message === null || message === void 0 ? void 0 : (_message$receiver = message.receiver) === null || _message$receiver === void 0 ? void 0 : (_message$receiver$_id = _message$receiver._id) === null || _message$receiver$_id === void 0 ? void 0 : (_message$receiver$_id2 = _message$receiver$_id.toString) === null || _message$receiver$_id2 === void 0 ? void 0 : _message$receiver$_id2.call(_message$receiver$_id)) || '';\n        const currentUserId = (user === null || user === void 0 ? void 0 : (_user$_id = user._id) === null || _user$_id === void 0 ? void 0 : (_user$_id$toString = _user$_id.toString) === null || _user$_id$toString === void 0 ? void 0 : _user$_id$toString.call(_user$_id)) || '';\n\n        // Prevent duplicate notifications from multi-emits and only notify receiver.\n        if (!messageId || seenMessageIdsRef.current.has(messageId)) return;\n        seenMessageIdsRef.current.add(messageId);\n        if (seenMessageIdsRef.current.size > 300) {\n          // Keep memory bounded in long sessions.\n          seenMessageIdsRef.current.clear();\n          seenMessageIdsRef.current.add(messageId);\n        }\n        const isIncomingForCurrentUser = receiverId === currentUserId && senderId && senderId !== currentUserId;\n        if (!isIncomingForCurrentUser) return;\n        toast.success(/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"New message\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 65,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: message.content\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 66,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 64,\n          columnNumber: 11\n        }, this), {\n          duration: 4000\n        });\n      });\n      newSocket.on('error', error => {\n        toast.error(error.message);\n      });\n      setSocket(newSocket);\n      return () => {\n        newSocket.close();\n      };\n    }\n  }, [isAuthenticated, user]);\n  const joinConversation = userId => {\n    if (socket) {\n      socket.emit('conversation:join', {\n        userId\n      });\n    }\n  };\n  const sendMessage = (receiverId, content) => {\n    if (socket) {\n      socket.emit('message:send', {\n        receiverId,\n        content\n      });\n    }\n  };\n  const startTyping = receiverId => {\n    if (socket) {\n      socket.emit('typing:start', {\n        receiverId\n      });\n    }\n  };\n  const stopTyping = receiverId => {\n    if (socket) {\n      socket.emit('typing:stop', {\n        receiverId\n      });\n    }\n  };\n  const value = {\n    socket,\n    onlineUsers,\n    joinConversation,\n    sendMessage,\n    startTyping,\n    stopTyping,\n    isOnline: userId => onlineUsers.includes(userId)\n  };\n  return /*#__PURE__*/_jsxDEV(SocketContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this);\n};\n_s2(SocketProvider, \"L9fJ+GTS6U90QRspy6vHVvfXztU=\", false, function () {\n  return [useAuth];\n});\n_c = SocketProvider;\nvar _c;\n$RefreshReg$(_c, \"SocketProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","io","useAuth","toast","jsxDEV","_jsxDEV","SocketContext","useSocket","_s","context","Error","SocketProvider","children","_s2","socket","setSocket","onlineUsers","setOnlineUsers","user","isAuthenticated","seenMessageIdsRef","useRef","Set","SOCKET_URL","process","env","REACT_APP_SOCKET_URL","newSocket","auth","token","localStorage","getItem","on","console","log","users","userId","prev","filter","id","message","_message$sender","_message$sender$_id","_message$sender$_id$t","_message$receiver","_message$receiver$_id","_message$receiver$_id2","_user$_id","_user$_id$toString","messageId","_id","senderId","sender","toString","call","receiverId","receiver","currentUserId","current","has","add","size","clear","isIncomingForCurrentUser","success","fileName","_jsxFileName","lineNumber","columnNumber","content","duration","error","close","joinConversation","emit","sendMessage","startTyping","stopTyping","value","isOnline","includes","Provider","_c","$RefreshReg$"],"sources":["C:/Users/satya/OneDrive/Desktop/creatorconnect-backend/frontend/src/context/SocketContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport { useAuth } from './AuthContext';\nimport toast from 'react-hot-toast';\n\r\nconst SocketContext = createContext();\r\n\r\nexport const useSocket = () => {\r\n  const context = useContext(SocketContext);\r\n  if (!context) {\r\n    throw new Error('useSocket must be used within a SocketProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const SocketProvider = ({ children }) => {\n  const [socket, setSocket] = useState(null);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const { user, isAuthenticated } = useAuth();\n  const seenMessageIdsRef = React.useRef(new Set());\n\r\n  useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:5001';\n      \r\n      const newSocket = io(SOCKET_URL, {\r\n        auth: {\r\n          token: localStorage.getItem('token')\r\n        }\r\n      });\r\n\r\n      newSocket.on('connect', () => {\r\n        console.log('Socket connected');\r\n      });\r\n\r\n      newSocket.on('user:online', (users) => {\r\n        setOnlineUsers(users);\r\n      });\r\n\r\n      newSocket.on('user:offline', (userId) => {\r\n        setOnlineUsers(prev => prev.filter(id => id !== userId));\r\n      });\r\n\r\n      newSocket.on('message:received', (message) => {\n        const messageId = message?._id;\n        const senderId = message?.sender?._id?.toString?.() || '';\n        const receiverId = message?.receiver?._id?.toString?.() || '';\n        const currentUserId = user?._id?.toString?.() || '';\n\n        // Prevent duplicate notifications from multi-emits and only notify receiver.\n        if (!messageId || seenMessageIdsRef.current.has(messageId)) return;\n        seenMessageIdsRef.current.add(messageId);\n        if (seenMessageIdsRef.current.size > 300) {\n          // Keep memory bounded in long sessions.\n          seenMessageIdsRef.current.clear();\n          seenMessageIdsRef.current.add(messageId);\n        }\n\n        const isIncomingForCurrentUser =\n          receiverId === currentUserId && senderId && senderId !== currentUserId;\n        if (!isIncomingForCurrentUser) return;\n\n        toast.success(\n          <div>\n            <div>New message</div>\n            <div>{message.content}</div>\n          </div>,\n          {\n          duration: 4000\n          }\n        );\n      });\n\r\n      newSocket.on('error', (error) => {\r\n        toast.error(error.message);\r\n      });\r\n\r\n      setSocket(newSocket);\r\n\r\n      return () => {\r\n        newSocket.close();\r\n      };\r\n    }\r\n  }, [isAuthenticated, user]);\r\n\r\n  const joinConversation = (userId) => {\r\n    if (socket) {\r\n      socket.emit('conversation:join', { userId });\r\n    }\r\n  };\r\n\r\n  const sendMessage = (receiverId, content) => {\r\n    if (socket) {\r\n      socket.emit('message:send', { receiverId, content });\r\n    }\r\n  };\r\n\r\n  const startTyping = (receiverId) => {\r\n    if (socket) {\r\n      socket.emit('typing:start', { receiverId });\r\n    }\r\n  };\r\n\r\n  const stopTyping = (receiverId) => {\r\n    if (socket) {\r\n      socket.emit('typing:stop', { receiverId });\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    socket,\r\n    onlineUsers,\r\n    joinConversation,\r\n    sendMessage,\r\n    startTyping,\r\n    stopTyping,\r\n    isOnline: (userId) => onlineUsers.includes(userId)\r\n  };\r\n\r\n  return (\r\n    <SocketContext.Provider value={value}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}