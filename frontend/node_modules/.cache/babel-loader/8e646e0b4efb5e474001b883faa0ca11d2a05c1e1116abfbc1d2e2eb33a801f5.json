{"ast":null,"code":"import _objectSpread from\"C:/Users/satya/OneDrive/Desktop/creatorconnect-backend/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useState,useContext,useEffect}from'react';import api from'../config/api';import toast from'react-hot-toast';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const extractErrorMessage=(error,fallbackMessage)=>{var _error$response;const data=error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data;if(!data)return fallbackMessage;if(typeof data.message==='string'&&data.message.trim())return data.message;if(Array.isArray(data.errors)&&data.errors.length>0){return data.errors[0].msg||fallbackMessage;}return fallbackMessage;};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[token,setToken]=useState(localStorage.getItem('token'));useEffect(()=>{if(token){fetchUser();}else{setLoading(false);}},[token]);const fetchUser=async()=>{try{const response=await api.get('/auth/me');setUser(response.data);}catch(error){console.error('Fetch user error:',error);logout();}finally{setLoading(false);}};const login=async(email,password)=>{try{const response=await api.post('/auth/login',{email,password});if(response.data.requiresOTP){return{requiresOTP:true,email,devOtp:response.data.devOtp};}return response.data;}catch(error){throw{message:extractErrorMessage(error,'Login failed')};}};const register=async userData=>{try{const response=await api.post('/auth/register',userData);if(response.data.token){localStorage.setItem('token',response.data.token);setToken(response.data.token);setUser(response.data);toast.success('Registration successful!');}return response.data;}catch(error){throw{message:extractErrorMessage(error,'Registration failed')};}};const verifyOTP=async(email,otp)=>{try{const response=await api.post('/auth/verify-otp',{email,otp});if(response.data.token){localStorage.setItem('token',response.data.token);setToken(response.data.token);setUser(response.data);toast.success('Login successful!');}return response.data;}catch(error){throw{message:extractErrorMessage(error,'OTP verification failed')};}};const resendOTP=async email=>{try{const response=await api.post('/auth/resend-otp',{email});toast.success('OTP resent successfully!');return response.data;}catch(error){throw{message:extractErrorMessage(error,'Failed to resend OTP')};}};const logout=()=>{localStorage.removeItem('token');setToken(null);setUser(null);toast.success('Logged out successfully');};const updateUser=updatedData=>{setUser(prev=>_objectSpread(_objectSpread({},prev),updatedData));};const value={user,loading,login,register,verifyOTP,resendOTP,logout,updateUser,isAuthenticated:!!user};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","api","toast","jsx","_jsx","AuthContext","extractErrorMessage","error","fallbackMessage","_error$response","data","response","message","trim","Array","isArray","errors","length","msg","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","setToken","localStorage","getItem","fetchUser","get","console","logout","login","email","password","post","requiresOTP","devOtp","register","userData","setItem","success","verifyOTP","otp","resendOTP","removeItem","updateUser","updatedData","prev","_objectSpread","value","isAuthenticated","Provider"],"sources":["C:/Users/satya/OneDrive/Desktop/creatorconnect-backend/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport api from '../config/api';\r\nimport toast from 'react-hot-toast';\n\nconst AuthContext = createContext();\nconst extractErrorMessage = (error, fallbackMessage) => {\n  const data = error?.response?.data;\n  if (!data) return fallbackMessage;\n  if (typeof data.message === 'string' && data.message.trim()) return data.message;\n  if (Array.isArray(data.errors) && data.errors.length > 0) {\n    return data.errors[0].msg || fallbackMessage;\n  }\n  return fallbackMessage;\n};\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      fetchUser();\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, [token]);\r\n\r\n  const fetchUser = async () => {\r\n    try {\r\n      const response = await api.get('/auth/me');\r\n      setUser(response.data);\r\n    } catch (error) {\r\n      console.error('Fetch user error:', error);\r\n      logout();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email, password) => {\n    try {\n      const response = await api.post('/auth/login', { email, password });\n      \n      if (response.data.requiresOTP) {\n        return { requiresOTP: true, email, devOtp: response.data.devOtp };\n      }\n      \r\n      return response.data;\n    } catch (error) {\n      throw { message: extractErrorMessage(error, 'Login failed') };\n    }\n  };\n\r\n  const register = async (userData) => {\r\n    try {\n      const response = await api.post('/auth/register', userData);\n      \r\n      if (response.data.token) {\r\n        localStorage.setItem('token', response.data.token);\r\n        setToken(response.data.token);\r\n        setUser(response.data);\r\n        toast.success('Registration successful!');\r\n      }\r\n      \r\n      return response.data;\n    } catch (error) {\n      throw { message: extractErrorMessage(error, 'Registration failed') };\n    }\n  };\n\r\n  const verifyOTP = async (email, otp) => {\r\n    try {\n      const response = await api.post('/auth/verify-otp', { email, otp });\n      \r\n      if (response.data.token) {\r\n        localStorage.setItem('token', response.data.token);\r\n        setToken(response.data.token);\r\n        setUser(response.data);\r\n        toast.success('Login successful!');\r\n      }\r\n      \r\n      return response.data;\n    } catch (error) {\n      throw { message: extractErrorMessage(error, 'OTP verification failed') };\n    }\n  };\n\r\n  const resendOTP = async (email) => {\r\n    try {\n      const response = await api.post('/auth/resend-otp', { email });\n      toast.success('OTP resent successfully!');\n      return response.data;\n    } catch (error) {\n      throw { message: extractErrorMessage(error, 'Failed to resend OTP') };\n    }\n  };\n\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    setToken(null);\r\n    setUser(null);\r\n    toast.success('Logged out successfully');\r\n  };\r\n\r\n  const updateUser = (updatedData) => {\r\n    setUser(prev => ({ ...prev, ...updatedData }));\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    loading,\r\n    login,\r\n    register,\r\n    verifyOTP,\r\n    resendOTP,\r\n    logout,\r\n    updateUser,\r\n    isAuthenticated: !!user\r\n  };\r\n\r\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}