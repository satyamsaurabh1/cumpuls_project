{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\satya\\\\OneDrive\\\\Desktop\\\\creatorconnect-backend\\\\frontend\\\\src\\\\context\\\\SocketContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport { useAuth } from './AuthContext';\nimport toast from 'react-hot-toast';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SocketContext = /*#__PURE__*/createContext();\nexport const useSocket = () => {\n  _s();\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n_s(useSocket, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const SocketProvider = ({\n  children\n}) => {\n  _s2();\n  const [socket, setSocket] = useState(null);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const {\n    user,\n    isAuthenticated\n  } = useAuth();\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:5001';\n      const newSocket = io(SOCKET_URL, {\n        auth: {\n          token: localStorage.getItem('token')\n        }\n      });\n      newSocket.on('connect', () => {\n        console.log('Socket connected');\n      });\n      newSocket.on('user:online', users => {\n        setOnlineUsers(users);\n      });\n      newSocket.on('user:offline', userId => {\n        setOnlineUsers(prev => prev.filter(id => id !== userId));\n      });\n      newSocket.on('message:received', message => {\n        toast.custom(t => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `${t.visible ? 'animate-enter' : 'animate-leave'} max-w-md w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 w-0 p-4\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-start\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex-shrink-0 pt-0.5\",\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  className: \"h-10 w-10 rounded-full\",\n                  src: message.sender.avatar,\n                  alt: \"\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 49,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 48,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ml-3 flex-1\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm font-medium text-gray-900\",\n                  children: message.sender.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 56,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"mt-1 text-sm text-gray-500\",\n                  children: message.content\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 59,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 55,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 47,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 46,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex border-l border-gray-200\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                window.location.href = `/messages/${message.sender._id}`;\n                toast.dismiss(t.id);\n              },\n              className: \"w-full border border-transparent rounded-none rounded-r-lg p-4 flex items-center justify-center text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none\",\n              children: \"Reply\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 66,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 65,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 11\n        }, this), {\n          duration: 5000\n        });\n      });\n      newSocket.on('error', error => {\n        toast.error(error.message);\n      });\n      setSocket(newSocket);\n      return () => {\n        newSocket.close();\n      };\n    }\n  }, [isAuthenticated, user]);\n  const joinConversation = userId => {\n    if (socket) {\n      socket.emit('conversation:join', {\n        userId\n      });\n    }\n  };\n  const sendMessage = (receiverId, content) => {\n    if (socket) {\n      socket.emit('message:send', {\n        receiverId,\n        content\n      });\n    }\n  };\n  const startTyping = receiverId => {\n    if (socket) {\n      socket.emit('typing:start', {\n        receiverId\n      });\n    }\n  };\n  const stopTyping = receiverId => {\n    if (socket) {\n      socket.emit('typing:stop', {\n        receiverId\n      });\n    }\n  };\n  const value = {\n    socket,\n    onlineUsers,\n    joinConversation,\n    sendMessage,\n    startTyping,\n    stopTyping,\n    isOnline: userId => onlineUsers.includes(userId)\n  };\n  return /*#__PURE__*/_jsxDEV(SocketContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 129,\n    columnNumber: 5\n  }, this);\n};\n_s2(SocketProvider, \"qCAgFEQenH8E1aELkCuUAnfNxXI=\", false, function () {\n  return [useAuth];\n});\n_c = SocketProvider;\nvar _c;\n$RefreshReg$(_c, \"SocketProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","io","useAuth","toast","jsxDEV","_jsxDEV","SocketContext","useSocket","_s","context","Error","SocketProvider","children","_s2","socket","setSocket","onlineUsers","setOnlineUsers","user","isAuthenticated","SOCKET_URL","process","env","REACT_APP_SOCKET_URL","newSocket","auth","token","localStorage","getItem","on","console","log","users","userId","prev","filter","id","message","custom","t","className","visible","src","sender","avatar","alt","fileName","_jsxFileName","lineNumber","columnNumber","name","content","onClick","window","location","href","_id","dismiss","duration","error","close","joinConversation","emit","sendMessage","receiverId","startTyping","stopTyping","value","isOnline","includes","Provider","_c","$RefreshReg$"],"sources":["C:/Users/satya/OneDrive/Desktop/creatorconnect-backend/frontend/src/context/SocketContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport io from 'socket.io-client';\r\nimport { useAuth } from './AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst SocketContext = createContext();\r\n\r\nexport const useSocket = () => {\r\n  const context = useContext(SocketContext);\r\n  if (!context) {\r\n    throw new Error('useSocket must be used within a SocketProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const SocketProvider = ({ children }) => {\r\n  const [socket, setSocket] = useState(null);\r\n  const [onlineUsers, setOnlineUsers] = useState([]);\r\n  const { user, isAuthenticated } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:5001';\n      \r\n      const newSocket = io(SOCKET_URL, {\r\n        auth: {\r\n          token: localStorage.getItem('token')\r\n        }\r\n      });\r\n\r\n      newSocket.on('connect', () => {\r\n        console.log('Socket connected');\r\n      });\r\n\r\n      newSocket.on('user:online', (users) => {\r\n        setOnlineUsers(users);\r\n      });\r\n\r\n      newSocket.on('user:offline', (userId) => {\r\n        setOnlineUsers(prev => prev.filter(id => id !== userId));\r\n      });\r\n\r\n      newSocket.on('message:received', (message) => {\r\n        toast.custom((t) => (\r\n          <div className={`${t.visible ? 'animate-enter' : 'animate-leave'} max-w-md w-full bg-white shadow-lg rounded-lg pointer-events-auto flex ring-1 ring-black ring-opacity-5`}>\r\n            <div className=\"flex-1 w-0 p-4\">\r\n              <div className=\"flex items-start\">\r\n                <div className=\"flex-shrink-0 pt-0.5\">\r\n                  <img\r\n                    className=\"h-10 w-10 rounded-full\"\r\n                    src={message.sender.avatar}\r\n                    alt=\"\"\r\n                  />\r\n                </div>\r\n                <div className=\"ml-3 flex-1\">\r\n                  <p className=\"text-sm font-medium text-gray-900\">\r\n                    {message.sender.name}\r\n                  </p>\r\n                  <p className=\"mt-1 text-sm text-gray-500\">\r\n                    {message.content}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex border-l border-gray-200\">\r\n              <button\r\n                onClick={() => {\r\n                  window.location.href = `/messages/${message.sender._id}`;\r\n                  toast.dismiss(t.id);\r\n                }}\r\n                className=\"w-full border border-transparent rounded-none rounded-r-lg p-4 flex items-center justify-center text-sm font-medium text-indigo-600 hover:text-indigo-500 focus:outline-none\"\r\n              >\r\n                Reply\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ), {\r\n          duration: 5000,\r\n        });\r\n      });\r\n\r\n      newSocket.on('error', (error) => {\r\n        toast.error(error.message);\r\n      });\r\n\r\n      setSocket(newSocket);\r\n\r\n      return () => {\r\n        newSocket.close();\r\n      };\r\n    }\r\n  }, [isAuthenticated, user]);\r\n\r\n  const joinConversation = (userId) => {\r\n    if (socket) {\r\n      socket.emit('conversation:join', { userId });\r\n    }\r\n  };\r\n\r\n  const sendMessage = (receiverId, content) => {\r\n    if (socket) {\r\n      socket.emit('message:send', { receiverId, content });\r\n    }\r\n  };\r\n\r\n  const startTyping = (receiverId) => {\r\n    if (socket) {\r\n      socket.emit('typing:start', { receiverId });\r\n    }\r\n  };\r\n\r\n  const stopTyping = (receiverId) => {\r\n    if (socket) {\r\n      socket.emit('typing:stop', { receiverId });\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    socket,\r\n    onlineUsers,\r\n    joinConversation,\r\n    sendMessage,\r\n    startTyping,\r\n    stopTyping,\r\n    isOnline: (userId) => onlineUsers.includes(userId)\r\n  };\r\n\r\n  return (\r\n    <SocketContext.Provider value={value}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,UAAU,EAAEC,SAAS,QAAQ,OAAO;AAC7E,OAAOC,EAAE,MAAM,kBAAkB;AACjC,SAASC,OAAO,QAAQ,eAAe;AACvC,OAAOC,KAAK,MAAM,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEpC,MAAMC,aAAa,gBAAGT,aAAa,CAAC,CAAC;AAErC,OAAO,MAAMU,SAAS,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC7B,MAAMC,OAAO,GAAGV,UAAU,CAACO,aAAa,CAAC;EACzC,IAAI,CAACG,OAAO,EAAE;IACZ,MAAM,IAAIC,KAAK,CAAC,gDAAgD,CAAC;EACnE;EACA,OAAOD,OAAO;AAChB,CAAC;AAACD,EAAA,CANWD,SAAS;AAQtB,OAAO,MAAMI,cAAc,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,GAAA;EAC9C,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAC1C,MAAM,CAACkB,WAAW,EAAEC,cAAc,CAAC,GAAGnB,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM;IAAEoB,IAAI;IAAEC;EAAgB,CAAC,GAAGjB,OAAO,CAAC,CAAC;EAE3CF,SAAS,CAAC,MAAM;IACd,IAAImB,eAAe,IAAID,IAAI,EAAE;MAC3B,MAAME,UAAU,GAAGC,OAAO,CAACC,GAAG,CAACC,oBAAoB,IAAI,uBAAuB;MAE9E,MAAMC,SAAS,GAAGvB,EAAE,CAACmB,UAAU,EAAE;QAC/BK,IAAI,EAAE;UACJC,KAAK,EAAEC,YAAY,CAACC,OAAO,CAAC,OAAO;QACrC;MACF,CAAC,CAAC;MAEFJ,SAAS,CAACK,EAAE,CAAC,SAAS,EAAE,MAAM;QAC5BC,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC;MACjC,CAAC,CAAC;MAEFP,SAAS,CAACK,EAAE,CAAC,aAAa,EAAGG,KAAK,IAAK;QACrCf,cAAc,CAACe,KAAK,CAAC;MACvB,CAAC,CAAC;MAEFR,SAAS,CAACK,EAAE,CAAC,cAAc,EAAGI,MAAM,IAAK;QACvChB,cAAc,CAACiB,IAAI,IAAIA,IAAI,CAACC,MAAM,CAACC,EAAE,IAAIA,EAAE,KAAKH,MAAM,CAAC,CAAC;MAC1D,CAAC,CAAC;MAEFT,SAAS,CAACK,EAAE,CAAC,kBAAkB,EAAGQ,OAAO,IAAK;QAC5ClC,KAAK,CAACmC,MAAM,CAAEC,CAAC,iBACblC,OAAA;UAAKmC,SAAS,EAAE,GAAGD,CAAC,CAACE,OAAO,GAAG,eAAe,GAAG,eAAe,0GAA2G;UAAA7B,QAAA,gBACzKP,OAAA;YAAKmC,SAAS,EAAC,gBAAgB;YAAA5B,QAAA,eAC7BP,OAAA;cAAKmC,SAAS,EAAC,kBAAkB;cAAA5B,QAAA,gBAC/BP,OAAA;gBAAKmC,SAAS,EAAC,sBAAsB;gBAAA5B,QAAA,eACnCP,OAAA;kBACEmC,SAAS,EAAC,wBAAwB;kBAClCE,GAAG,EAAEL,OAAO,CAACM,MAAM,CAACC,MAAO;kBAC3BC,GAAG,EAAC;gBAAE;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACP;cAAC;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACC,CAAC,eACN5C,OAAA;gBAAKmC,SAAS,EAAC,aAAa;gBAAA5B,QAAA,gBAC1BP,OAAA;kBAAGmC,SAAS,EAAC,mCAAmC;kBAAA5B,QAAA,EAC7CyB,OAAO,CAACM,MAAM,CAACO;gBAAI;kBAAAJ,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACnB,CAAC,eACJ5C,OAAA;kBAAGmC,SAAS,EAAC,4BAA4B;kBAAA5B,QAAA,EACtCyB,OAAO,CAACc;gBAAO;kBAAAL,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACf,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACD,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC,eACN5C,OAAA;YAAKmC,SAAS,EAAC,+BAA+B;YAAA5B,QAAA,eAC5CP,OAAA;cACE+C,OAAO,EAAEA,CAAA,KAAM;gBACbC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,aAAalB,OAAO,CAACM,MAAM,CAACa,GAAG,EAAE;gBACxDrD,KAAK,CAACsD,OAAO,CAAClB,CAAC,CAACH,EAAE,CAAC;cACrB,CAAE;cACFI,SAAS,EAAC,8KAA8K;cAAA5B,QAAA,EACzL;YAED;cAAAkC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CACN,EAAE;UACDS,QAAQ,EAAE;QACZ,CAAC,CAAC;MACJ,CAAC,CAAC;MAEFlC,SAAS,CAACK,EAAE,CAAC,OAAO,EAAG8B,KAAK,IAAK;QAC/BxD,KAAK,CAACwD,KAAK,CAACA,KAAK,CAACtB,OAAO,CAAC;MAC5B,CAAC,CAAC;MAEFtB,SAAS,CAACS,SAAS,CAAC;MAEpB,OAAO,MAAM;QACXA,SAAS,CAACoC,KAAK,CAAC,CAAC;MACnB,CAAC;IACH;EACF,CAAC,EAAE,CAACzC,eAAe,EAAED,IAAI,CAAC,CAAC;EAE3B,MAAM2C,gBAAgB,GAAI5B,MAAM,IAAK;IACnC,IAAInB,MAAM,EAAE;MACVA,MAAM,CAACgD,IAAI,CAAC,mBAAmB,EAAE;QAAE7B;MAAO,CAAC,CAAC;IAC9C;EACF,CAAC;EAED,MAAM8B,WAAW,GAAGA,CAACC,UAAU,EAAEb,OAAO,KAAK;IAC3C,IAAIrC,MAAM,EAAE;MACVA,MAAM,CAACgD,IAAI,CAAC,cAAc,EAAE;QAAEE,UAAU;QAAEb;MAAQ,CAAC,CAAC;IACtD;EACF,CAAC;EAED,MAAMc,WAAW,GAAID,UAAU,IAAK;IAClC,IAAIlD,MAAM,EAAE;MACVA,MAAM,CAACgD,IAAI,CAAC,cAAc,EAAE;QAAEE;MAAW,CAAC,CAAC;IAC7C;EACF,CAAC;EAED,MAAME,UAAU,GAAIF,UAAU,IAAK;IACjC,IAAIlD,MAAM,EAAE;MACVA,MAAM,CAACgD,IAAI,CAAC,aAAa,EAAE;QAAEE;MAAW,CAAC,CAAC;IAC5C;EACF,CAAC;EAED,MAAMG,KAAK,GAAG;IACZrD,MAAM;IACNE,WAAW;IACX6C,gBAAgB;IAChBE,WAAW;IACXE,WAAW;IACXC,UAAU;IACVE,QAAQ,EAAGnC,MAAM,IAAKjB,WAAW,CAACqD,QAAQ,CAACpC,MAAM;EACnD,CAAC;EAED,oBACE5B,OAAA,CAACC,aAAa,CAACgE,QAAQ;IAACH,KAAK,EAAEA,KAAM;IAAAvD,QAAA,EAClCA;EAAQ;IAAAkC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACa,CAAC;AAE7B,CAAC;AAACpC,GAAA,CArHWF,cAAc;EAAA,QAGST,OAAO;AAAA;AAAAqE,EAAA,GAH9B5D,cAAc;AAAA,IAAA4D,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}