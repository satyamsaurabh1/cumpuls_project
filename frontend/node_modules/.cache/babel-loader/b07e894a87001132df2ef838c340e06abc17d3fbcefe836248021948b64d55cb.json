{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\satya\\\\OneDrive\\\\Desktop\\\\creatorconnect-backend\\\\frontend\\\\src\\\\pages\\\\Messages.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../context/AuthContext';\nimport { useSocket } from '../context/SocketContext';\nimport api from '../config/api';\nimport { FiSend, FiArrowLeft, FiMoreVertical, FiUser, FiCheck, FiMessageCircle } from 'react-icons/fi';\nimport { format } from 'date-fns';\nimport toast from 'react-hot-toast';\nimport './Messages.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Messages = () => {\n  _s();\n  const {\n    userId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth();\n  const {\n    socket,\n    sendMessage,\n    joinConversation,\n    isOnline,\n    startTyping,\n    stopTyping\n  } = useSocket();\n  const [conversations, setConversations] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [typingUser, setTypingUser] = useState(null);\n  const messagesEndRef = useRef(null);\n  const typingTimeoutRef = useRef(null);\n  useEffect(() => {\n    fetchConversations();\n  }, []);\n  useEffect(() => {\n    if (userId) {\n      fetchConversation(userId);\n      joinConversation(userId);\n    }\n  }, [userId]);\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n  useEffect(() => {\n    if (!socket || !user) return;\n    const handleIncomingMessage = message => {\n      var _message$sender, _message$sender$_id, _message$sender$_id$t, _message$receiver, _message$receiver$_id, _message$receiver$_id2, _user$_id;\n      const otherUserId = userId === null || userId === void 0 ? void 0 : userId.toString();\n      const senderId = message === null || message === void 0 ? void 0 : (_message$sender = message.sender) === null || _message$sender === void 0 ? void 0 : (_message$sender$_id = _message$sender._id) === null || _message$sender$_id === void 0 ? void 0 : (_message$sender$_id$t = _message$sender$_id.toString) === null || _message$sender$_id$t === void 0 ? void 0 : _message$sender$_id$t.call(_message$sender$_id);\n      const receiverId = message === null || message === void 0 ? void 0 : (_message$receiver = message.receiver) === null || _message$receiver === void 0 ? void 0 : (_message$receiver$_id = _message$receiver._id) === null || _message$receiver$_id === void 0 ? void 0 : (_message$receiver$_id2 = _message$receiver$_id.toString) === null || _message$receiver$_id2 === void 0 ? void 0 : _message$receiver$_id2.call(_message$receiver$_id);\n      const currentUserId = (_user$_id = user._id) === null || _user$_id === void 0 ? void 0 : _user$_id.toString();\n\n      // Keep conversation list fresh in real-time.\n      fetchConversations();\n      if (!otherUserId) return;\n      const belongsToActiveConversation = senderId === otherUserId && receiverId === currentUserId || senderId === currentUserId && receiverId === otherUserId;\n      if (!belongsToActiveConversation) return;\n      setMessages(prev => {\n        if (prev.some(msg => msg._id === message._id)) return prev;\n        return [...prev, message];\n      });\n    };\n    const handleTypingStart = ({\n      userId: typingUserId,\n      name\n    }) => {\n      var _typingUserId$toStrin, _userId$toString;\n      if ((typingUserId === null || typingUserId === void 0 ? void 0 : (_typingUserId$toStrin = typingUserId.toString) === null || _typingUserId$toStrin === void 0 ? void 0 : _typingUserId$toStrin.call(typingUserId)) === (userId === null || userId === void 0 ? void 0 : (_userId$toString = userId.toString) === null || _userId$toString === void 0 ? void 0 : _userId$toString.call(userId))) {\n        setTypingUser(name || 'Someone');\n      }\n    };\n    const handleTypingStop = ({\n      userId: typingUserId\n    }) => {\n      var _typingUserId$toStrin2, _userId$toString2;\n      if ((typingUserId === null || typingUserId === void 0 ? void 0 : (_typingUserId$toStrin2 = typingUserId.toString) === null || _typingUserId$toStrin2 === void 0 ? void 0 : _typingUserId$toStrin2.call(typingUserId)) === (userId === null || userId === void 0 ? void 0 : (_userId$toString2 = userId.toString) === null || _userId$toString2 === void 0 ? void 0 : _userId$toString2.call(userId))) {\n        setTypingUser(null);\n      }\n    };\n    socket.on('message:received', handleIncomingMessage);\n    socket.on('typing:start', handleTypingStart);\n    socket.on('typing:stop', handleTypingStop);\n    return () => {\n      socket.off('message:received', handleIncomingMessage);\n      socket.off('typing:start', handleTypingStart);\n      socket.off('typing:stop', handleTypingStop);\n    };\n  }, [socket, user, userId]);\n  const fetchConversations = async () => {\n    try {\n      const response = await api.get('/messages/conversations');\n      setConversations(response.data);\n    } catch (error) {\n      toast.error('Failed to load conversations');\n    } finally {\n      setLoading(false);\n    }\n  };\n  const fetchConversation = async otherUserId => {\n    try {\n      const response = await api.get(`/messages/${otherUserId}`);\n      setMessages(response.data);\n\n      // Find and set selected user\n      if (response.data.length > 0) {\n        const otherUser = response.data[0].sender._id === user._id ? response.data[0].receiver : response.data[0].sender;\n        setSelectedUser(otherUser);\n      } else {\n        // If no messages yet, fetch user details\n        const userResponse = await api.get(`/users/${otherUserId}`);\n        setSelectedUser(userResponse.data);\n      }\n    } catch (error) {\n      toast.error('Failed to load conversation');\n    }\n  };\n  const handleSendMessage = e => {\n    e.preventDefault();\n    if (!newMessage.trim() || !selectedUser) return;\n    sendMessage(selectedUser._id, newMessage);\n    setNewMessage('');\n    stopTyping(selectedUser._id);\n  };\n  const handleTyping = () => {\n    if (!selectedUser) return;\n    startTyping(selectedUser._id);\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    typingTimeoutRef.current = setTimeout(() => {\n      stopTyping(selectedUser._id);\n    }, 1000);\n  };\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  };\n  const formatMessageTime = timestamp => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));\n    if (diffInDays === 0) {\n      return format(date, 'hh:mm a');\n    } else if (diffInDays === 1) {\n      return 'Yesterday';\n    } else if (diffInDays < 7) {\n      return format(date, 'EEEE');\n    } else {\n      return format(date, 'MMM d, yyyy');\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-spinner\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading messages...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"messages-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `conversations-sidebar ${userId ? 'hidden-mobile' : ''}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar-header\",\n        children: /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Messages\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"conversations-list\",\n        children: [conversations.map(conv => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `conversation-item ${conv.user._id === userId ? 'active' : ''}`,\n          onClick: () => navigate(`/messages/${conv.user._id}`),\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"conversation-avatar\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: conv.user.avatar,\n              alt: conv.user.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 17\n            }, this), isOnline(conv.user._id) && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"online-dot\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 45\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"conversation-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"conversation-header\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: \"conversation-name\",\n                children: conv.user.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 193,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"conversation-time\",\n                children: formatMessageTime(conv.lastMessage.createdAt)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"conversation-preview\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"last-message\",\n                children: [conv.lastMessage.sender._id === user._id ? 'You: ' : '', conv.lastMessage.content]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 199,\n                columnNumber: 19\n              }, this), conv.unreadCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"unread-badge\",\n                children: conv.unreadCount\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 15\n          }, this)]\n        }, conv.user._id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 13\n        }, this)), conversations.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-conversations\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"No conversations yet\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"no-conversations-sub\",\n            children: \"Go to the dashboard to connect with other creators\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `chat-area ${!userId ? 'hidden-mobile' : ''}`,\n      children: selectedUser ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"back-button\",\n            onClick: () => navigate('/messages'),\n            children: /*#__PURE__*/_jsxDEV(FiArrowLeft, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 231,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 227,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-user-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: selectedUser.avatar,\n              alt: selectedUser.name,\n              className: \"chat-avatar\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-user-details\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                children: selectedUser.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: `user-status ${isOnline(selectedUser._id) ? 'online' : ''}`,\n                children: isOnline(selectedUser._id) ? 'Online' : 'Offline'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 241,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"header-action\",\n            children: /*#__PURE__*/_jsxDEV(FiMoreVertical, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"messages-list\",\n          children: [messages.map((msg, index) => {\n            var _messages;\n            const isOwnMessage = msg.sender._id === user._id;\n            const showAvatar = index === 0 || ((_messages = messages[index - 1]) === null || _messages === void 0 ? void 0 : _messages.sender._id) !== msg.sender._id;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `message-wrapper ${isOwnMessage ? 'own' : ''}`,\n              children: [!isOwnMessage && showAvatar && /*#__PURE__*/_jsxDEV(\"img\", {\n                src: msg.sender.avatar,\n                alt: msg.sender.name,\n                className: \"message-avatar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 263,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `message-bubble ${isOwnMessage ? 'own' : ''}`,\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"message-content\",\n                  children: msg.content\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 270,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"message-meta\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"message-time\",\n                    children: format(new Date(msg.createdAt), 'hh:mm a')\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 272,\n                    columnNumber: 25\n                  }, this), isOwnMessage && /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"message-status\",\n                    children: /*#__PURE__*/_jsxDEV(FiCheck, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 278,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 276,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 271,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 269,\n                columnNumber: 21\n              }, this)]\n            }, msg._id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 19\n            }, this);\n          }), typingUser && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"typing-indicator\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 288,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 290,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: messagesEndRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 293,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSendMessage,\n          className: \"message-input-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: newMessage,\n            onChange: e => setNewMessage(e.target.value),\n            onKeyUp: handleTyping,\n            placeholder: \"Type a message...\",\n            className: \"message-input\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"send-button\",\n            disabled: !newMessage.trim(),\n            children: /*#__PURE__*/_jsxDEV(FiSend, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"no-chat-selected\",\n        children: [/*#__PURE__*/_jsxDEV(FiMessageCircle, {\n          className: \"no-chat-icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Your Messages\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Select a conversation to start chatting\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 174,\n    columnNumber: 5\n  }, this);\n};\n_s(Messages, \"nTmLziQcOBApHUf2kdvqMfpzWNs=\", false, function () {\n  return [useParams, useNavigate, useAuth, useSocket];\n});\n_c = Messages;\nexport default Messages;\nvar _c;\n$RefreshReg$(_c, \"Messages\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","useAuth","useSocket","api","FiSend","FiArrowLeft","FiMoreVertical","FiUser","FiCheck","FiMessageCircle","format","toast","jsxDEV","_jsxDEV","Fragment","_Fragment","Messages","_s","userId","navigate","user","socket","sendMessage","joinConversation","isOnline","startTyping","stopTyping","conversations","setConversations","messages","setMessages","newMessage","setNewMessage","selectedUser","setSelectedUser","loading","setLoading","typingUser","setTypingUser","messagesEndRef","typingTimeoutRef","fetchConversations","fetchConversation","scrollToBottom","handleIncomingMessage","message","_message$sender","_message$sender$_id","_message$sender$_id$t","_message$receiver","_message$receiver$_id","_message$receiver$_id2","_user$_id","otherUserId","toString","senderId","sender","_id","call","receiverId","receiver","currentUserId","belongsToActiveConversation","prev","some","msg","handleTypingStart","typingUserId","name","_typingUserId$toStrin","_userId$toString","handleTypingStop","_typingUserId$toStrin2","_userId$toString2","on","off","response","get","data","error","length","otherUser","userResponse","handleSendMessage","e","preventDefault","trim","handleTyping","current","clearTimeout","setTimeout","_messagesEndRef$curre","scrollIntoView","behavior","formatMessageTime","timestamp","date","Date","now","diffInDays","Math","floor","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","conv","onClick","src","avatar","alt","lastMessage","createdAt","content","unreadCount","index","_messages","isOwnMessage","showAvatar","ref","onSubmit","type","value","onChange","target","onKeyUp","placeholder","disabled","_c","$RefreshReg$"],"sources":["C:/Users/satya/OneDrive/Desktop/creatorconnect-backend/frontend/src/pages/Messages.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useSocket } from '../context/SocketContext';\r\nimport api from '../config/api';\r\nimport { FiSend, FiArrowLeft, FiMoreVertical, FiUser, FiCheck, FiMessageCircle } from 'react-icons/fi';\r\nimport { format } from 'date-fns';\r\nimport toast from 'react-hot-toast';\r\nimport './Messages.css';\r\n\r\nconst Messages = () => {\r\n  const { userId } = useParams();\r\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const { socket, sendMessage, joinConversation, isOnline, startTyping, stopTyping } = useSocket();\n  const [conversations, setConversations] = useState([]);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [typingUser, setTypingUser] = useState(null);\r\n  const messagesEndRef = useRef(null);\r\n  const typingTimeoutRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    fetchConversations();\r\n  }, []);\r\n\r\n  useEffect(() => {\n    if (userId) {\n      fetchConversation(userId);\n      joinConversation(userId);\n    }\r\n  }, [userId]);\r\n\r\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  useEffect(() => {\n    if (!socket || !user) return;\n\n    const handleIncomingMessage = (message) => {\n      const otherUserId = userId?.toString();\n      const senderId = message?.sender?._id?.toString?.();\n      const receiverId = message?.receiver?._id?.toString?.();\n      const currentUserId = user._id?.toString();\n\n      // Keep conversation list fresh in real-time.\n      fetchConversations();\n\n      if (!otherUserId) return;\n\n      const belongsToActiveConversation =\n        (senderId === otherUserId && receiverId === currentUserId) ||\n        (senderId === currentUserId && receiverId === otherUserId);\n\n      if (!belongsToActiveConversation) return;\n\n      setMessages((prev) => {\n        if (prev.some((msg) => msg._id === message._id)) return prev;\n        return [...prev, message];\n      });\n    };\n\n    const handleTypingStart = ({ userId: typingUserId, name }) => {\n      if (typingUserId?.toString?.() === userId?.toString?.()) {\n        setTypingUser(name || 'Someone');\n      }\n    };\n\n    const handleTypingStop = ({ userId: typingUserId }) => {\n      if (typingUserId?.toString?.() === userId?.toString?.()) {\n        setTypingUser(null);\n      }\n    };\n\n    socket.on('message:received', handleIncomingMessage);\n    socket.on('typing:start', handleTypingStart);\n    socket.on('typing:stop', handleTypingStop);\n\n    return () => {\n      socket.off('message:received', handleIncomingMessage);\n      socket.off('typing:start', handleTypingStart);\n      socket.off('typing:stop', handleTypingStop);\n    };\n  }, [socket, user, userId]);\n\r\n  const fetchConversations = async () => {\r\n    try {\r\n      const response = await api.get('/messages/conversations');\r\n      setConversations(response.data);\r\n    } catch (error) {\r\n      toast.error('Failed to load conversations');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchConversation = async (otherUserId) => {\r\n    try {\r\n      const response = await api.get(`/messages/${otherUserId}`);\r\n      setMessages(response.data);\r\n      \r\n      // Find and set selected user\r\n      if (response.data.length > 0) {\r\n        const otherUser = response.data[0].sender._id === user._id\r\n          ? response.data[0].receiver\r\n          : response.data[0].sender;\r\n        setSelectedUser(otherUser);\r\n      } else {\r\n        // If no messages yet, fetch user details\r\n        const userResponse = await api.get(`/users/${otherUserId}`);\r\n        setSelectedUser(userResponse.data);\r\n      }\r\n    } catch (error) {\r\n      toast.error('Failed to load conversation');\r\n    }\r\n  };\r\n\r\n  const handleSendMessage = (e) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !selectedUser) return;\r\n\r\n    sendMessage(selectedUser._id, newMessage);\r\n    setNewMessage('');\r\n    stopTyping(selectedUser._id);\r\n  };\r\n\r\n  const handleTyping = () => {\r\n    if (!selectedUser) return;\r\n\r\n    startTyping(selectedUser._id);\r\n\r\n    if (typingTimeoutRef.current) {\r\n      clearTimeout(typingTimeoutRef.current);\r\n    }\r\n\r\n    typingTimeoutRef.current = setTimeout(() => {\r\n      stopTyping(selectedUser._id);\r\n    }, 1000);\r\n  };\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  };\r\n\r\n  const formatMessageTime = (timestamp) => {\r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffInDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));\r\n\r\n    if (diffInDays === 0) {\r\n      return format(date, 'hh:mm a');\r\n    } else if (diffInDays === 1) {\r\n      return 'Yesterday';\r\n    } else if (diffInDays < 7) {\r\n      return format(date, 'EEEE');\r\n    } else {\r\n      return format(date, 'MMM d, yyyy');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading-container\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p>Loading messages...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"messages-container\">\r\n      {/* Conversations Sidebar */}\r\n      <div className={`conversations-sidebar ${userId ? 'hidden-mobile' : ''}`}>\r\n        <div className=\"sidebar-header\">\r\n          <h2>Messages</h2>\r\n        </div>\r\n        <div className=\"conversations-list\">\r\n          {conversations.map((conv) => (\r\n            <div\r\n              key={conv.user._id}\r\n              className={`conversation-item ${conv.user._id === userId ? 'active' : ''}`}\r\n              onClick={() => navigate(`/messages/${conv.user._id}`)}\r\n            >\r\n              <div className=\"conversation-avatar\">\r\n                <img src={conv.user.avatar} alt={conv.user.name} />\r\n                {isOnline(conv.user._id) && <span className=\"online-dot\"></span>}\r\n              </div>\r\n              <div className=\"conversation-info\">\r\n                <div className=\"conversation-header\">\r\n                  <h3 className=\"conversation-name\">{conv.user.name}</h3>\r\n                  <span className=\"conversation-time\">\r\n                    {formatMessageTime(conv.lastMessage.createdAt)}\r\n                  </span>\r\n                </div>\r\n                <div className=\"conversation-preview\">\r\n                  <p className=\"last-message\">\r\n                    {conv.lastMessage.sender._id === user._id ? 'You: ' : ''}\r\n                    {conv.lastMessage.content}\r\n                  </p>\r\n                  {conv.unreadCount > 0 && (\r\n                    <span className=\"unread-badge\">{conv.unreadCount}</span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          {conversations.length === 0 && (\r\n            <div className=\"no-conversations\">\r\n              <p>No conversations yet</p>\r\n              <p className=\"no-conversations-sub\">\r\n                Go to the dashboard to connect with other creators\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Chat Area */}\r\n      <div className={`chat-area ${!userId ? 'hidden-mobile' : ''}`}>\r\n        {selectedUser ? (\r\n          <>\r\n            <div className=\"chat-header\">\r\n              <button\r\n                className=\"back-button\"\r\n                onClick={() => navigate('/messages')}\r\n              >\r\n                <FiArrowLeft />\r\n              </button>\r\n              <div className=\"chat-user-info\">\r\n                <img\r\n                  src={selectedUser.avatar}\r\n                  alt={selectedUser.name}\r\n                  className=\"chat-avatar\"\r\n                />\r\n                <div className=\"chat-user-details\">\r\n                  <h3>{selectedUser.name}</h3>\r\n                  <span className={`user-status ${isOnline(selectedUser._id) ? 'online' : ''}`}>\r\n                    {isOnline(selectedUser._id) ? 'Online' : 'Offline'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <button className=\"header-action\">\r\n                <FiMoreVertical />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"messages-list\">\r\n              {messages.map((msg, index) => {\r\n                const isOwnMessage = msg.sender._id === user._id;\r\n                const showAvatar = index === 0 || \r\n                  messages[index - 1]?.sender._id !== msg.sender._id;\r\n\r\n                return (\r\n                  <div\r\n                    key={msg._id}\r\n                    className={`message-wrapper ${isOwnMessage ? 'own' : ''}`}\r\n                  >\r\n                    {!isOwnMessage && showAvatar && (\r\n                      <img\r\n                        src={msg.sender.avatar}\r\n                        alt={msg.sender.name}\r\n                        className=\"message-avatar\"\r\n                      />\r\n                    )}\r\n                    <div className={`message-bubble ${isOwnMessage ? 'own' : ''}`}>\r\n                      <p className=\"message-content\">{msg.content}</p>\r\n                      <div className=\"message-meta\">\r\n                        <span className=\"message-time\">\r\n                          {format(new Date(msg.createdAt), 'hh:mm a')}\r\n                        </span>\r\n                        {isOwnMessage && (\r\n                          <span className=\"message-status\">\r\n                            {/* Using single check for both sent and read */}\r\n                            <FiCheck />\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n              {typingUser && (\n                <div className=\"typing-indicator\">\n                  <span></span>\n                  <span></span>\n                  <span></span>\n                </div>\n              )}\r\n              <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            <form onSubmit={handleSendMessage} className=\"message-input-container\">\r\n              <input\r\n                type=\"text\"\r\n                value={newMessage}\r\n                onChange={(e) => setNewMessage(e.target.value)}\r\n                onKeyUp={handleTyping}\r\n                placeholder=\"Type a message...\"\r\n                className=\"message-input\"\r\n              />\r\n              <button\r\n                type=\"submit\"\r\n                className=\"send-button\"\r\n                disabled={!newMessage.trim()}\r\n              >\r\n                <FiSend />\r\n              </button>\r\n            </form>\r\n          </>\r\n        ) : (\r\n          <div className=\"no-chat-selected\">\r\n            <FiMessageCircle className=\"no-chat-icon\" />\r\n            <h3>Your Messages</h3>\r\n            <p>Select a conversation to start chatting</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Messages;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}